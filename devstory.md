# ê°œë°œ ê³¼ì • ê¸°ë¡.(ë¡œì»¬ ê°œë°œ)

---

## ~ 2025-10-18 : íŒŒì´ì¬ ETL ì‘ì—… ì§„í–‰.

- íŒŒì´ì¬ í™˜ê²½ ì„¤ì •.
- "ì„œìš¸ì‹œ ì‹í’ˆì—…ì†Œ ëª©ë¡.csv" íŒŒì¼ ë‹¤ìš´ë¡œë“œ.
- "ì„œìš¸ì‹œ ì‹í’ˆì—…ì†Œ ëª©ë¡.csv" íŒŒì¼ postgres DBì— ì ì¬.
- ì§€ì˜¤ì½”ë”© ì‘ì—… ì§„í–‰.(í˜„ì¬ 2000ê±´)

---

## 2025-10-19

### ğŸš€ 1ë‹¨ê³„: ë°ì´í„° ê¸°ë°˜ í™•ë³´ ë° ì¤€ë¹„ (ì„¸ë¶€ ê³„íš).

> Nest.jsì™€ PostGISê°€ ê³ ì„±ëŠ¥ìœ¼ë¡œ í†µì‹ í•  ìˆ˜ ìˆë„ë¡ DB í™˜ê²½ì„ ìµœì¢… ì ê²€í•˜ê³ , ë¶„ì„ì— í•„ìš”í•œ í•µì‹¬ ì¿¼ë¦¬ë¥¼ í™•ì •

#### 1.1 ì§€ì˜¤ì½”ë”© ì™„ë£Œ ë° í’ˆì§ˆ ê²€ì¦ (2,000ê±´ ìœ ì§€)

- ëª©í‘œ
  > 2,000ê°œì˜ ë ˆì½”ë“œê°€ PostGIS location ì»¬ëŸ¼ì— ì •í™•í•œ ì¢Œí‘œë¥¼ ê°€ì§€ê³  ìˆëŠ”ì§€ ìµœì¢… í™•ì¸.
- ì„¸ë¶€ ì‘ì—….
  - 1.  ì”ì—¬ ë°ì´í„° í™•ì¸ : ëª‡ ê±´ì„ ë” ë³€í™˜í•´ì•¼ í•˜ëŠ”ì§€ í™•ì¸
  - 2.  ë°ì´í„° í’ˆì§ˆ í™•ì¸ : ë³€í™˜ëœ 2,000ê±´ì˜ location ì»¬ëŸ¼ì— POINT(...) í˜•íƒœì˜ ë°ì´í„°ê°€ ë“¤ì–´ ìˆìœ¼ë©°, PostGISì˜ SRIDê°€ 4326ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸

#### 1.2 Redis ì„œë²„ êµ¬ì¶•.

- ëª©í‘œ

  > Nest.js ë°±ì—”ë“œì˜ ìºì‹± ê¸°ëŠ¥ì„ ìœ„í•´ Redis ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¤€ë¹„.

- ì„¸ë¶€ ì‘ì—….

  - ë„ì»¤ë¥¼ ì‚¬ìš©í•˜ì—¬, ë¡œì»¬ í™˜ê²½ì—ì„œ Redis ì„œë²„ ê°œë°œ.

    > ë¡œì»¬ì— ì§ì ‘ ì„¤ì¹˜í•œ ê²ƒì²˜ëŸ¼ localhost:6379ë¡œ ì ‘ì†í•  ìˆ˜ ìˆì–´ ê°œë°œ ê²½í—˜ì„ ìœ ì§€í•˜ë©´ì„œë„, WSL í™˜ê²½ ì˜¤ë¥˜ë¥¼ ì™„ë²½í•˜ê²Œ íšŒí”¼.

    - 1.  Redis ì»¨í…Œì´ë„ˆ ì‹¤í–‰.
      - docker run --name redis_local_dev -d -p 6379:6379 redis:6-alpine
        > ì´ ëª…ë ¹ì–´ëŠ” Redisë¥¼ ì‹¤í–‰í•˜ê³  ì»¨í…Œì´ë„ˆì˜ 6379 í¬íŠ¸ë¥¼ Windows (ë¡œì»¬) í™˜ê²½ì˜ 6379 í¬íŠ¸ì— ì—°ê²°í•©ë‹ˆë‹¤. ë”°ë¼ì„œ Nest.jsëŠ” Redisê°€ ë„ì»¤ ì»¨í…Œì´ë„ˆ ì•ˆì— ìˆëŠ”ì§€ ì•Œ í•„ìš” ì—†ì´ localhost:6379ë¡œ ì ‘ì†
        - ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ê³  ë„ì»¤ì—ì„œ ë ˆë””ìŠ¤ë¥¼ ì‹¤í–‰í•˜ë©°, ìë™ìœ¼ë¡œ ë¡œì»¬ í¬íŠ¸ì™€ ì—°ê²°.
        - Redis ì„œë²„ ìƒíƒœ í™•ì¸ : docker ps -f name=redis_local_dev
          - STATUS : Up X seconds í‘œì‹œ
          - PORTS : 0.0.0.0:6379->6379/tcp
    - 2.  Redis ì„œë²„-nest.js ì—°ë™.

      - nest.js í”„ë¡œì íŠ¸ ë§Œë“¤ê¸°.

        - nest ì „ì—­ ì„¤ì¹˜. : npm install -g @nestjs/cli
        - í™˜ê²½ ë³€ìˆ˜ í™•ì¸(ì„ íƒ ì‚¬í•­)

          - Node.js ì„¤ì¹˜ ê²½ë¡œ í™•ì¸ì¸ : npm root -g
          - ì‹œìŠ¤í…œ í™˜ê²½ë³€ìˆ˜ í¸ì§‘ì—ì„œ Pathë³€ìˆ˜ì— npm ì „ì—­ ê²½ë¡œê°€ ìˆëŠ”ì§€ í™•ì¸.

        - ìµœì¢… í™•ì¸ : nest --version.

      > nest.js ì‘ì—…ì˜ ë””ë ‰í† ë¦¬ ì´ë™ : cd analytics-backend.

      - nest.js í”„ë¡œì íŠ¸ ìƒì„±. : nest new analytics-backend -> íŒ¨í‚¤ì§€ ë§¤ë‹ˆì € npm ì‚¬ìš©.

        - í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ ì´ë™. : cd analytics-backend
        - íŒ¨í‚¤ì§€ ì„¤ì¹˜ í™•ì¸ : npm uninstall cache-manager-redis-store && npm install cache-manager-redis-yet
        - src/app.module.ts íŒŒì¼ì„ ìˆ˜ì •í•˜ì—¬ **CacheModule**ì„ Redisì™€ ì—°ê²°í•˜ê³ , ì´ë¥¼ ì „ì—­ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •.
          - ì¶”ê°€ íŒ¨í‚¤ì§€ ì„¤ì¹˜ : npm install @nestjs/typeorm @nestjs/config typeorm pg.
        - .envì— redis ì •ë³´ ì¶”ê°€.
        - nest.js ê²½ë¡œì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ : npm run start:dev.

      - redis ì„ì‹œ í…ŒìŠ¤íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ ìƒì„±.
        - ì»¨íŠ¸ë¡¤ëŸ¬ ìƒì„± : nest generate controller test
        - ìºì‹± ì ìš© : src/test/test.controller.ts íŒŒì¼ì„ ìˆ˜ì •í•˜ì—¬ @CacheInterceptorë¥¼ ì ìš©.

#### 1.2.1 Redis ìºì‹± ë¬¸ì œ í•´ê²° ê³¼ì •

**ë¬¸ì œ ìƒí™©:**

- Redis ì„œë²„ëŠ” ì •ìƒ ì‘ë™ (docker exec -it "redis_local_dev" redis-cli ping â†’ PONG)
- NestJSì—ì„œ ìºì‹œ ì €ì¥ì€ ì„±ê³µí•˜ì§€ë§Œ ì¡°íšŒ ì‹œ `undefined` ë°˜í™˜
- ìºì‹œê°€ ì €ì¥ë˜ìë§ˆì ì‚¬ë¼ì§€ëŠ” í˜„ìƒ ë°œìƒ

**í•´ê²° ê³¼ì •:**

1. **íŒ¨í‚¤ì§€ í˜¸í™˜ì„± ë¬¸ì œ í•´ê²°**

   ```bash
   # ê¸°ì¡´ íŒ¨í‚¤ì§€ ì œê±° ë° í˜¸í™˜ì„± ì¢‹ì€ íŒ¨í‚¤ì§€ë¡œ êµì²´
   npm uninstall cache-manager-redis-store
   npm install cache-manager-redis-yet
   ```

2. **ìºì‹œ ì„¤ì • ë°©ì‹ ë³€ê²½**

   - `CacheInterceptor` â†’ ìˆ˜ë™ ìºì‹œ ê´€ë¦¬ë¡œ ë³€ê²½
   - `@Inject(CACHE_MANAGER)`ë¥¼ í†µí•œ ì§ì ‘ ìºì‹œ ì œì–´

3. **TTL ë‹¨ìœ„ ë¬¸ì œ ë°œê²¬ ë° í•´ê²°**

   ```typescript
   // âŒ ì˜ëª»ëœ ì„¤ì • (300ms = 0.3ì´ˆ)
   await this.cacheManager.set(cacheKey, data, 300);

   // âœ… ì˜¬ë°”ë¥¸ ì„¤ì • (300,000ms = 5ë¶„)
   await this.cacheManager.set(cacheKey, data, 300000);
   ```

**ìµœì¢… í•´ê²°ì±…:**

- `cache-manager`ì˜ `set()` ë©”ì„œë“œëŠ” TTLì„ **ë°€ë¦¬ì´ˆ ë‹¨ìœ„**ë¡œ ë°›ìŒ
- 300ì€ 300ms(0.3ì´ˆ)ë¡œ ê±°ì˜ ì¦‰ì‹œ ë§Œë£Œë˜ì–´ ìºì‹±ì´ ì‘ë™í•˜ì§€ ì•Šì•˜ìŒ
- 300,000ms(5ë¶„)ë¡œ ìˆ˜ì •í•˜ì—¬ ì •ìƒ ì‘ë™ í™•ì¸

**ê²°ê³¼:**

- ìºì‹œ ì €ì¥/ì¡°íšŒ ì •ìƒ ì‘ë™
- ì²« ë²ˆì§¸ í˜¸ì¶œ: ë°ì´í„° ìƒì„± ë° ìºì‹œ ì €ì¥
- ë‘ ë²ˆì§¸ í˜¸ì¶œ: ìºì‹œëœ ë°ì´í„° ë°˜í™˜ (ì¹´ìš´í„° ì¦ê°€ ì—†ìŒ)

//ì»¤ë°‹ ì •ë£Œ ì˜ í™•ì¸í•˜ì.

#### 1.3 í•µì‹¬ ì§€í‘œ ì¿¼ë¦¬ ì‘ì„±(SQL í™•ì •)
