# 공간 분석 API 테스트 가이드

**대상**: `/spatial/stores-within-radius` 엔드포인트  
**작성일**: 2025-12-21

---

## 🎯 테스트 목표

1. 다양한 좌표와 반경으로 정상 작동 확인
2. 업종 필터링 정확성 검증
3. 에러 케이스 처리 확인
4. 응답 시간 측정 (목표: 100ms 이하)

---

## 📍 서울 주요 지역 좌표

### 테스트용 좌표 목록

| 지역     | 위도 (lat) | 경도 (lng) | 설명             |
| :------- | :--------- | :--------- | :--------------- |
| 명동     | 37.5636    | 126.9826   | 관광지, 상업지역 |
| 강남역   | 37.4980    | 127.0276   | 주요 상권        |
| 홍대입구 | 37.5563    | 126.9236   | 젊은 상권        |
| 이태원   | 37.5345    | 126.9949   | 외국인 상권      |
| 종로3가  | 37.5704    | 126.9918   | 전통 상권        |
| 잠실     | 37.5133    | 127.1028   | 주거/상업 복합   |
| 신촌     | 37.5551    | 126.9368   | 대학가 상권      |
| 건대입구 | 37.5407    | 127.0692   | 젊은 상권        |

---

## ✅ 정상 케이스 테스트

### 1. 기본 조회 (전체 업종)

```bash
# 명동 주변 500m
GET /spatial/stores-within-radius?lat=37.5636&lng=126.9826&radius=500

# 강남역 주변 1000m
GET /spatial/stores-within-radius?lat=37.4980&lng=127.0276&radius=1000
```

**검증 항목:**

- [ ] 200 응답 코드
- [ ] 배열 형태 응답
- [ ] 각 항목에 id, storeName, sector, address, location 포함
- [ ] 응답 시간 100ms 이하

---

### 2. 업종 필터링 테스트

```bash
# 명동 주변 일반음식점만 조회
GET /spatial/stores-within-radius?lat=37.5636&lng=126.9826&radius=500&sector=일반음식점

# 강남역 주변 즉석판매제조가공업만 조회
GET /spatial/stores-within-radius?lat=37.4980&lng=127.0276&radius=1000&sector=즉석판매제조가공업
```

**검증 항목:**

- [ ] 200 응답 코드
- [ ] 모든 반환된 점포의 sector가 지정한 업종과 일치
- [ ] 업종 필터링 없이 조회한 결과보다 개수가 같거나 적음

---

### 3. 다양한 반경 테스트

```bash
# 매우 좁은 범위 (100m)
GET /spatial/stores-within-radius?lat=37.5636&lng=126.9826&radius=100

# 넓은 범위 (2000m)
GET /spatial/stores-within-radius?lat=37.5636&lng=126.9826&radius=2000

# 중간 범위 (500m)
GET /spatial/stores-within-radius?lat=37.5636&lng=126.9826&radius=500
```

**검증 항목:**

- [ ] 반경이 클수록 점포 수 증가
- [ ] 반경 100m: 보통 0-10개
- [ ] 반경 500m: 보통 10-50개
- [ ] 반경 2000m: 보통 50-100개 (LIMIT 100 적용)

---

## ❌ 에러 케이스 테스트

### 1. 좌표 범위 초과

```bash
# 위도 초과
GET /spatial/stores-within-radius?lat=100&lng=126.9826&radius=500
# 예상 응답: 400 Bad Request - "위도는 -90 ~ 90 범위여야 합니다. 입력된 값: 100"

# 경도 초과
GET /spatial/stores-within-radius?lat=37.5636&lng=200&radius=500
# 예상 응답: 400 Bad Request - "경도는 -180 ~ 180 범위여야 합니다. 입력된 값: 200"
```

**검증 항목:**

- [ ] 400 응답 코드
- [ ] 명확한 에러 메시지
- [ ] 입력된 값이 메시지에 포함됨

---

### 2. 반경 범위 초과

```bash
# 반경이 너무 작음
GET /spatial/stores-within-radius?lat=37.5636&lng=126.9826&radius=0
# 예상 응답: 400 Bad Request - "반경은 최소 1미터 이상이어야 합니다. 입력된 값: 0"

# 반경이 너무 큼
GET /spatial/stores-within-radius?lat=37.5636&lng=126.9826&radius=20000
# 예상 응답: 400 Bad Request - "반경은 최대 10,000미터(10km) 이하여야 합니다. 입력된 값: 20000"
```

**검증 항목:**

- [ ] 400 응답 코드
- [ ] 명확한 에러 메시지
- [ ] 허용 범위가 메시지에 명시됨

---

### 3. 빈 업종 코드

```bash
GET /spatial/stores-within-radius?lat=37.5636&lng=126.9826&radius=500&sector=
# 예상 응답: 400 Bad Request - "업종 코드는 빈 문자열일 수 없습니다."
```

**검증 항목:**

- [ ] 400 응답 코드
- [ ] 명확한 에러 메시지

---

### 4. 데이터가 없는 경우

```bash
# 지오코딩되지 않은 지역 (예: 바다 위)
GET /spatial/stores-within-radius?lat=37.0&lng=126.0&radius=500
# 예상 응답: 200 OK - 빈 배열 []
```

**검증 항목:**

- [ ] 200 응답 코드 (에러 아님)
- [ ] 빈 배열 반환
- [ ] 서버 로그에 경고 메시지 출력

---

## 📊 성능 테스트

### 응답 시간 측정

각 테스트 케이스마다 응답 시간을 측정하고 기록:

| 테스트 케이스 | 반경  | 업종 필터  | 예상 응답 시간 | 실제 응답 시간 |
| :------------ | :---- | :--------- | :------------- | :------------- |
| 명동 500m     | 500m  | 없음       | < 100ms        | \_\_\_ms       |
| 명동 500m     | 500m  | 일반음식점 | < 100ms        | \_\_\_ms       |
| 강남역 1000m  | 1000m | 없음       | < 150ms        | \_\_\_ms       |
| 강남역 2000m  | 2000m | 없음       | < 200ms        | \_\_\_ms       |

**목표**: 모든 케이스에서 100ms 이하 (반경이 클수록 약간 증가 허용)

---

## 🔍 업종 필터링 정확성 검증

### 테스트 시나리오

1. **전체 업종 조회**

   ```bash
   GET /spatial/stores-within-radius?lat=37.5636&lng=126.9826&radius=500
   ```

   - 결과: A개 점포

2. **특정 업종 조회**

   ```bash
   GET /spatial/stores-within-radius?lat=37.5636&lng=126.9826&radius=500&sector=일반음식점
   ```

   - 결과: B개 점포

3. **검증**
   - [ ] B ≤ A (업종 필터링 시 개수가 같거나 적어야 함)
   - [ ] B개 점포의 모든 sector가 "일반음식점"과 일치
   - [ ] 전체 조회 결과에서 "일반음식점"만 필터링한 결과와 일치

---

## 📝 테스트 체크리스트

### 기능 검증

- [ ] 기본 조회 정상 작동
- [ ] 업종 필터링 정상 작동
- [ ] 다양한 반경으로 테스트
- [ ] 다양한 좌표로 테스트

### 에러 처리 검증

- [ ] 위도 범위 초과 에러 처리
- [ ] 경도 범위 초과 에러 처리
- [ ] 반경 최소값 에러 처리
- [ ] 반경 최대값 에러 처리
- [ ] 빈 업종 코드 에러 처리
- [ ] 데이터 없을 때 빈 배열 반환

### 성능 검증

- [ ] 모든 케이스 응답 시간 100ms 이하
- [ ] 서버 로그에 실행 시간 기록 확인

### 데이터 정확성 검증

- [ ] 반환된 점포의 좌표가 실제로 반경 내에 있는지 확인
- [ ] 업종 필터링 정확성 확인
- [ ] LIMIT 100 적용 확인

---

## 🚀 Swagger에서 테스트하기

1. `http://localhost:3000/api` 접속
2. `spatial` 태그 선택
3. `GET /spatial/stores-within-radius` 엔드포인트 클릭
4. "Try it out" 버튼 클릭
5. 파라미터 입력:
   - lat: `37.5636` (명동)
   - lng: `126.9826`
   - radius: `500`
   - sector: (선택) `일반음식점`
6. "Execute" 버튼 클릭
7. 응답 확인 및 응답 시간 측정

---

## 📌 테스트 결과 기록

테스트 완료 후 다음 정보를 기록:

- 테스트 일시: \***\*\_\_\_\*\***
- 테스트 환경: \***\*\_\_\_\*\***
- 총 테스트 케이스: \_\_\_개
- 통과한 테스트: \_\_\_개
- 실패한 테스트: \_\_\_개
- 평균 응답 시간: \_\_\_ms
- 최대 응답 시간: \_\_\_ms
- 발견된 이슈: \***\*\_\_\_\*\***

---

**다음 단계**: 테스트 완료 후 Phase 1.2 (공간 쿼리 성능 최적화)로 진행
